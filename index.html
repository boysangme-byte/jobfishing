<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>커리어 낚시터 4.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        :root { /* ... styles from v3 ... */ }
        /* v3의 스타일 대부분을 그대로 사용하되, 일부 개선된 스타일을 추가/수정합니다. */
        body { font-family: 'Jua', sans-serif; margin: 0; background-color: #A6DCEF; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .game-world { width: 100%; max-width: 1200px; height: 100%; max-height: 800px; background: linear-gradient(to bottom, #A6DCEF 40%, #639FAB 60%, #498BA3 80%, #2A5D72 100%); position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.2); overflow: hidden; }
        .water-surface { position: absolute; top: 50%; left: 0; width: 100%; height: 50%; overflow: hidden; }
        .wave { position: absolute; background: rgba(255,255,255,0.1); width: 200%; height: 200%; border-radius: 45%; animation: wave-motion 10s infinite linear; }
        .wave.one { top: -20px; left: -50%; } .wave.two { top: -30px; left: -50%; animation-delay: -3s; animation-duration: 12s; }
        @keyframes wave-motion { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .first-person-ui { position: absolute; bottom: 0; left: 0; width: 100%; height: 250px; z-index: 50; }
        .fishing-rod { position: absolute; bottom: -50px; right: -15%; width: 700px; height: 400px; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 400"><path d="M50,350 Q300,300 680,50" stroke="%238B4513" stroke-width="15" fill="none" stroke-linecap="round"/></svg>'); background-size: contain; background-repeat: no-repeat; transform-origin: 10% 90%; transition: transform 0.5s cubic-bezier(0.5, -0.75, 0.25, 1.5); }
        .fishing-rod.casting { transform: rotate(-20deg) scale(1.1); }
        .control-panel { position: absolute; bottom: 20px; left: 20px; background-color: #fdfaf1; padding: 15px 20px; border-radius: 15px; box-shadow: 5px 5px 10px rgba(0,0,0,0.3); border: 5px solid #8B4513; display: flex; gap: 15px; align-items: flex-end; }
        .filter-group { min-width: 160px; } .filter-group label { font-size: 1.2em; color: #8B4513; display: block; margin-bottom: 5px; }
        .filter-group select, .filter-group input { width: 100%; padding: 8px; border-radius: 8px; font-family: 'Jua', sans-serif; font-size: 1.1em; border: 2px solid #ccc; box-sizing: border-box; }
        #cast-btn { padding: 20px 25px; font-size: 1.8em; font-family: 'Jua', sans-serif; background-color: #d32f2f; color: white; border: 5px solid #b71c1c; border-radius: 50%; cursor: pointer; line-height: 1; box-shadow: 0 5px 0 #b71c1c; transition: all 0.1s; }
        #cast-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #b71c1c; }
        #cast-btn:disabled { background-color: #aaa; border-color: #777; box-shadow: 0 5px 0 #777; }
        #aquarium-btn { position: absolute; top: 20px; right: 20px; font-size: 1.5em; padding: 10px 15px; cursor: pointer; background-color: #4fc3f7; color: white; border-radius: 10px; border: 3px solid #039be5; z-index: 10; }
        
        /* --- 경력 체크박스 스타일 --- */
        #years-container { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        #years-container label { font-size: 1em; display: flex; align-items: center; }
        #years-container input { width: auto; margin-right: 5px; }
        .disabled-label { color: #aaa; }

        /* ... v3의 나머지 스타일 (fish, splash, modal 등) ... */
        .splash { position: absolute; width: 100px; height: 100px; background-color: white; border-radius: 50%; opacity: 0.7; animation: splash-effect 0.5s ease-out forwards; z-index: 15; }
        @keyframes splash-effect { from { transform: scale(0); opacity: 0.7; } to { transform: scale(2); opacity: 0; } }
        .fish, .trash { position: absolute; background-size: contain; background-repeat: no-repeat; cursor: pointer; animation: float 10s ease-in-out infinite; z-index: 20; transition: transform 0.2s; will-change: transform; }
        .fish:hover { transform: scale(1.15) rotate(5deg); }
        @keyframes float { 0% { transform: translate(0, 0) rotate(-5deg); } 50% { transform: translate(15px, -15px) rotate(5deg); } 100% { transform: translate(0, 0) rotate(-5deg); } }
        .trash { width: 80px; height: 80px; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%238B4513" d="M20,90 L20,40 Q20,30 30,30 L70,30 Q80,30 80,40 L80,60 L95,60 L95,90 L20,90 Z M30,20 L70,20 L70,30 L30,30 Z"/></svg>'); }
        .mackerel, .squid, .puffer-fish, .tuna, .whale { /* ... v3의 물고기 SVG ... */ }
        .mackerel { width: 130px; height: 50px; background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 130 50" xmlns="http://www.w3.org/2000/svg"><path d="M10 25 C 20 10, 80 10, 110 25 C 80 40, 20 40, 10 25 Z" fill="%2378909c"/><path d="M110 25 L130 10 L130 40 Z" fill="%2378909c"/><circle cx="20" cy="22" r="3" fill="white"/></svg>'); }
        .squid { width: 80px; height: 120px; background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 80 120" xmlns="http://www.w3.org/2000/svg"><path d="M10 40 C10 10, 70 10, 70 40 L60 110 L50 80 L40 110 L30 80 L20 110 Z" fill="%23ff8a65"/><circle cx="30" cy="35" r="5" fill="black"/><circle cx="50" cy="35" r="5" fill="black"/></svg>'); }
        .puffer-fish { width: 100px; height: 100px; background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="45" fill="%23ec407a"/><circle cx="35" cy="40" r="5" fill="white"/><circle cx="65" cy="40" r="5" fill="white"/></svg>'); }
        .tuna { width: 180px; height: 70px; background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 180 70" xmlns="http://www.w3.org/2000/svg"><path d="M10 35 C 20 10, 120 10, 160 35 C 120 60, 20 60, 10 35 Z" fill="%235c6bc0"/><path d="M160 35 L180 15 L180 55 Z" fill="%235c6bc0"/><circle cx="25" cy="30" r="4" fill="white"/></svg>'); }
        .whale { width: 250px; height: 120px; background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 250 120" xmlns="http://www.w3.org/2000/svg"><path d="M10 60 C 20 20, 180 20, 230 60 C 180 100, 20 100, 10 60 Z" fill="%23424242"/><path d="M230 60 L250 40 L250 80 Z" fill="%23424242"/><circle cx="40" cy="55" r="6" fill="white"/></svg>'); }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal-content { background: #fdfaf1; padding: 20px 30px; border-radius: 15px; width: 90%; max-width: 500px; border: 10px solid #8B4513; position: relative; }
        .close-btn { position: absolute; top: 5px; right: 15px; font-size: 2.5em; cursor: pointer; }
        #aquarium-list { list-style: none; padding: 0; max-height: 400px; overflow-y: auto; }
        #aquarium-list li { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #ddd; }
        #aquarium-list li button { font-family: 'Jua', sans-serif; font-size: 0.9em; padding: 3px 8px; background-color: #ef5350; border: none; color: white; border-radius: 5px; cursor:pointer;}
    </style>
</head>
<body>
    <audio id="cast-sound" src="path/to/casting.mp3"></audio>
    <audio id="splash-sound" src="path/to/splash.mp3"></audio>
    <audio id="click-sound" src="path/to/click.mp3"></audio>

    <div class="game-world">
        <div class="water-surface"><div class="wave one"></div><div class="wave two"></div></div>
        <div id="fish-container"></div>
        <div class="first-person-ui">
            <div class="fishing-rod" id="fishing-rod"></div>
            <div class="control-panel">
                <div class="filter-group">
                    <label>낚시터</label>
                    <div style="display: flex; gap: 5px;">
                        <select id="loc-major"><option value="all">- 전국 -</option></select>
                        <select id="loc-minor"><option value="">- 시/군/구 -</option></select>
                    </div>
                </div>
                <div class="filter-group">
                    <label for="keyword-input">특제 미끼</label>
                    <input type="text" id="keyword-input" placeholder="키워드 (React 등)">
                </div>
                <div class="filter-group">
                    <label>미끼 등급 (경력)</label>
                    <div id="years-container">
                        <label><input type="checkbox" name="years" value="-1">경력무관</label>
                        <label><input type="checkbox" name="years" value="0">신입</label>
                        <label><input type="checkbox" name="years" value="1">1~3년</label>
                        <label><input type="checkbox" name="years" value="4">4~6년</label>
                        <label><input type="checkbox" name="years" value="7">7~9년</label>
                        <label><input type="checkbox" name="years" value="10">10년+</label>
                    </div>
                </div>
                <button id="cast-btn" title="낚싯대 던지기">GO!</button>
            </div>
        </div>
        <button id="aquarium-btn">내 수족관</button>
    </div>
    
    <div class="modal-bg" id="job-modal">
        <div class="modal-content"><span class="close-btn">&times;</span><h2 id="modal-title"></h2><p><strong>- 어종:</strong> <span id="modal-fish-type"></span></p><p><strong>- 회사:</strong> <span id="modal-company"></span></p><p><strong>- 위치:</strong> <span id="modal-location"></span></p><a id="modal-link" href="#" target="_blank" rel="noopener noreferrer">자세한 공고 보기</a><br><br><button id="add-to-aquarium-btn">수족관에 담기</button></div>
    </div>
    <div class="modal-bg" id="aquarium-modal">
        <div class="modal-content"><span class="close-btn">&times;</span><h2>내 수족관</h2><ul id="aquarium-list"></ul></div>
    </div>

    <script>
        // --- DOM Elements & Data ---
        const castBtn = document.getElementById('cast-btn');
        const fishingRod = document.getElementById('fishing-rod');
        const fishContainer = document.getElementById('fish-container');
        const locMajorSelect = document.getElementById('loc-major');
        const locMinorSelect = document.getElementById('loc-minor');
        const yearsContainer = document.getElementById('years-container');
        const yearsCheckboxes = yearsContainer.querySelectorAll('input[name="years"]');
        const locations = { /* ... v3 location data ... */ "서울": ["강남구", "서초구", "송파구", "강동구", "마포구", "영등포구", "구로구", "금천구", "성동구"], "경기": ["성남시", "수원시", "용인시", "화성시", "고양시", "안양시", "부천시", "광명시"], "부산": ["해운대구", "부산진구", "수영구"], "인천": ["연수구", "부평구"], "대구": ["수성구", "중구"], "대전": ["유성구"], "광주": ["서구"] };
        const locationSlugs = { "성남시": "pangyo" };

        // --- Sound Functions ---
        const sounds = { cast: document.getElementById('cast-sound'), splash: document.getElementById('splash-sound'), click: document.getElementById('click-sound'), };
        function playSound(name) { try { if (sounds[name]) { sounds[name].currentTime = 0; sounds[name].play(); } } catch (e) { console.warn("Sound play failed:", e); } }

        // --- Modals (Simplified) ---
        const jobModal = { bg: document.getElementById('job-modal'), /* ... */ };
        const aquariumModal = { bg: document.getElementById('aquarium-modal'), list: document.getElementById('aquarium-list') };

        // --- Initialize ---
        function init() {
            Object.keys(locations).forEach(major => locMajorSelect.innerHTML += `<option value="${major}">${major}</option>`);
            castBtn.addEventListener('click', handleCasting);
            locMajorSelect.addEventListener('change', populateMinorLocations);
            document.getElementById('aquarium-btn').addEventListener('click', showAquarium);
            jobModal.bg.querySelector('.close-btn').addEventListener('click', () => jobModal.bg.style.display = 'none');
            aquariumModal.bg.querySelector('.close-btn').addEventListener('click', () => aquariumModal.bg.style.display = 'none');
            document.getElementById('add-to-aquarium-btn').addEventListener('click', () => { if (window.currentJobData) addToAquarium(window.currentJobData); });
            aquariumModal.list.addEventListener('click', (e) => { if(e.target.tagName === 'BUTTON') removeFromAquarium(parseInt(e.target.dataset.id)); });
            
            // 경력 체크박스 로직
            const noExperienceCheckbox = document.querySelector('input[name="years"][value="-1"]');
            noExperienceCheckbox.addEventListener('change', () => {
                const isChecked = noExperienceCheckbox.checked;
                yearsCheckboxes.forEach(cb => {
                    if (cb !== noExperienceCheckbox) {
                        cb.disabled = isChecked;
                        cb.checked = false; // 다른 체크박스 해제
                        cb.parentElement.classList.toggle('disabled-label', isChecked);
                    }
                });
            });
        }
        
        function populateMinorLocations() { /* ... v3 function ... */ const major = locMajorSelect.value; locMinorSelect.innerHTML = '<option value="">- 시/군/구 -</option>'; if (major && locations[major]) { locations[major].forEach(minor => { locMinorSelect.innerHTML += `<option value="${minor}">${minor}</option>`; }); } }

        // --- Core Fishing Logic ---
        async function handleCasting() {
            castBtn.disabled = true;
            fishContainer.innerHTML = '';
            fishingRod.classList.add('casting');
            playSound('cast');
            await new Promise(r => setTimeout(r, 500));
            fishingRod.classList.remove('casting');
            
            try {
                const jobs = await fetchJobs();
                displayResults(jobs);
            } catch (error) {
                console.error("낚시 실패:", error);
                alert("이런, 허탕이네요. API 요청에 실패했습니다. 잠시 후 다시 시도해주세요.");
            } finally {
                castBtn.disabled = false;
            }
        }

        async function fetchJobs() {
            const majorLoc = locMajorSelect.value;
            const minorLoc = locMinorSelect.value;
            let finalLoc = '';
            if (majorLoc !== 'all') { // "전국"이 아닐 때만 지역 파라미터 설정
                 if (minorLoc) {
                    finalLoc = (locationSlugs[minorLoc] || minorLoc.replace(/시|군|구$/, '').toLowerCase());
                } else if (majorLoc) {
                    finalLoc = majorLoc.toLowerCase();
                }
            }

            const params = new URLSearchParams({ country: 'kr', job_sort: 'company.response_rate_order', limit: 30 });
            const keyword = document.getElementById('keyword-input').value;

            // 경력 복수 선택 로직
            const selectedYears = Array.from(document.querySelectorAll('input[name="years"]:checked')).map(cb => cb.value);
            if (selectedYears.length > 0 && !selectedYears.includes('-1')) {
                selectedYears.forEach(year => params.append('years', year));
            } // '경력무관'이 선택되었거나 아무것도 선택 안되면 파라미터 추가 안함.
            
            if (keyword) params.set('keyword', keyword);
            if (finalLoc) params.set('locations', finalLoc);
            
            const finalUrl = `https://www.wanted.co.kr/api/v4/jobs?${params.toString()}`;
            const PROXY_URL = 'https://api.allorigins.win/raw?url='; // 더 안정적인 프록시로 변경
            const response = await fetch(PROXY_URL + encodeURIComponent(finalUrl));
            if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
            return (await response.json()).data;
        }

        function displayResults(jobs) { /* ... v3 function ... */ fishContainer.innerHTML = ''; if (!jobs || jobs.length === 0) { const trash = document.createElement('div'); trash.className = 'trash'; trash.style.top = `${55 + Math.random() * 20}%`; trash.style.left = `${10 + Math.random() * 70}%`; fishContainer.appendChild(trash); return; } jobs.forEach((job, i) => { setTimeout(() => { const top = 55 + Math.random() * 30; const left = 10 + Math.random() * 70; const splash = document.createElement('div'); splash.className = 'splash'; splash.style.top = `${top}%`; splash.style.left = `${left}%`; fishContainer.appendChild(splash); playSound('splash'); const fish = document.createElement('div'); const fishInfo = getFishType(job); fish.className = fishInfo.className; fish.style.top = `${top}%`; fish.style.left = `${left}%`; fish.style.animationDelay = `${Math.random() * 5}s`; fish.addEventListener('click', () => showJobDetails(job, fishInfo)); fishContainer.appendChild(fish); }, i * 100); }); }
        function getFishType(job) { /* ... v3 function ... */ const name = job.company.name.toLowerCase(); const pos = job.position.toLowerCase(); if (['네이버', '카카오', '라인', '쿠팡', '배달의민족', '토스'].some(c => name.includes(c))) return { className: 'whale', name: '전설의 고래' }; if (job.company.industry_name === 'IT, 컨텐츠' && (pos.includes('cto') || pos.includes('리드'))) return { className: 'tuna', name: '참치 (리드급)' }; if (name.includes('corp') || name.includes('ltd') || name.includes('닷컴')) return { className: 'puffer-fish', name: '복어 (외국계/닷컴)' }; if (pos.includes('스타트업') || job.like_count < 100) return { className: 'mackerel', name: '고등어 (스타트업)' }; return { className: 'squid', name: '오징어 (일반)' }; }
        function showJobDetails(job, fishInfo) { /* ... v3 function ... */ window.currentJobData = job; document.getElementById('modal-title').textContent = job.position; document.getElementById('modal-fish-type').textContent = fishInfo.name; document.getElementById('modal-company').textContent = job.company.name; document.getElementById('modal-location').textContent = job.address.full_location || '정보 없음'; document.getElementById('modal-link').href = `https://www.wanted.co.kr/wd/${job.id}`; jobModal.bg.style.display = 'flex'; playSound('click'); }
        
        // --- Aquarium Functions (LocalStorage) ---
        function addToAquarium(job) { /* ... v3 function ... */ let aquarium = JSON.parse(localStorage.getItem('myAquarium')) || []; if (!aquarium.some(item => item.id === job.id)) { aquarium.push({ id: job.id, position: job.position, company: job.company.name }); localStorage.setItem('myAquarium', JSON.stringify(aquarium)); alert('수족관에 추가했습니다!'); } else { alert('이미 수족관에 있습니다.'); } }
        function showAquarium() { /* ... v3 function ... */ const aquarium = JSON.parse(localStorage.getItem('myAquarium')) || []; aquariumModal.list.innerHTML = aquarium.length ? '' : '<li>수족관이 비었습니다.</li>'; aquarium.forEach(fish => { aquariumModal.list.innerHTML += `<li><div><strong>${fish.position}</strong><br><span>${fish.company}</span></div><button data-id="${fish.id}">방생</button></li>`; }); aquariumModal.bg.style.display = 'flex'; playSound('click'); }
        function removeFromAquarium(fishId) { /* ... v3 function ... */ let aquarium = JSON.parse(localStorage.getItem('myAquarium')) || []; localStorage.setItem('myAquarium', JSON.stringify(aquarium.filter(f => f.id !== fishId))); showAquarium(); }

        init();
    </script>
</body>
</html>