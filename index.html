<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>커리어 낚시터 (UI 위치 수정판)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        body { font-family: 'Jua', sans-serif; margin: 0; background-color: #A6DCEF; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .game-world { width: 100%; max-width: 1200px; height: 100%; max-height: 800px; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.2); overflow: hidden; background-image: url('1.png'); background-size: cover; background-position: center; }
        
        /* --- [최종 수정] 컨트롤 패널 위치 상단으로 조정 --- */
        .control-panel { 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            background-color: rgba(253, 250, 241, 0.95); padding: 15px; border-radius: 15px; box-shadow: 5px 5px 10px rgba(0,0,0,0.3); border: 5px solid #8B4513; display: flex; gap: 10px; align-items: flex-end; z-index: 51; pointer-events: auto; 
        }
        .fishing-rod { 
            position: absolute; bottom: -150px; right: -250px; width: 1200px; height: 900px; 
            background-image: url('2.png'); 
            background-size: contain; background-repeat: no-repeat; transform-origin: 30% 80%; 
            transition: transform 0.5s cubic-bezier(0.5, -0.75, 0.25, 1.5); pointer-events: none;
            z-index: 40; /* 컨트롤 패널보다 아래, 물고기보다 위에 위치 */
        }
        .fishing-rod.casting { transform: rotate(-15deg) scale(1.05); }
        
        #aquarium-btn { position: absolute; top: 20px; right: 20px; font-size: 1.5em; padding: 10px 15px; cursor: pointer; background-color: #4fc3f7; color: white; border-radius: 10px; border: 3px solid #039be5; z-index: 51; pointer-events: auto; }
        .filter-group { min-width: 130px; }
        .filter-group label.group-title { font-size: 1.2em; color: #8B4513; display: block; margin-bottom: 5px; text-align: center; }
        select { width: 100%; padding: 8px; border-radius: 8px; font-family: 'Jua', sans-serif; font-size: 1.1em; border: 2px solid #ccc; box-sizing: border-box; }
        .checkbox-section { display: flex; gap: 10px; }
        .checkbox-container { display: flex; flex-direction: column; gap: 2px; background-color: rgba(240,240,240,0.8); padding: 8px; border-radius: 5px; max-height: 120px; overflow-y: auto; }
        .checkbox-container .category-title { font-size: 1.1em; color: #333; margin-bottom: 4px; border-bottom: 2px solid #ccc; padding-bottom: 2px;}
        .checkbox-container label { font-size: 1em; display: flex; align-items: center; white-space: nowrap; }
        .checkbox-container input { width: auto; margin-right: 5px; }
        .disabled-label { color: #aaa; text-decoration: line-through; }
        .game-controls { display: flex; flex-direction: column; align-items: center; gap: 10px; min-width: 200px; }
        .gauge-container { width: 100%; text-align: center; } .gauge-label { font-size: 1.2em; }
        .power-gauge, .angle-gauge { width: 100%; height: 30px; background-color: #ddd; border: 2px solid #555; border-radius: 5px; overflow: hidden; position: relative; }
        .power-bar { width: 0%; height: 100%; background: linear-gradient(to right, #fbc531, #f53b57, #e84393); }
        .power-gauge.active .power-bar { animation: fill-power 1.5s linear infinite alternate; }
        @keyframes fill-power { from { width: 0%; } to { width: 100%; } }
        .angle-indicator { position: absolute; top:0; left: 50%; width: 4px; height: 100%; background-color: #333; transform-origin: top center; }
        .angle-gauge.active .angle-indicator { animation: swing-angle 2s ease-in-out infinite alternate; }
        @keyframes swing-angle { from { transform: translateX(-98px) rotate(-45deg); } to { transform: translateX(98px) rotate(45deg); } }
        #action-btn { width: 100%; padding: 10px; font-size: 1.5em; font-family: 'Jua', sans-serif; border-radius: 10px; cursor: pointer; border-width: 5px; border-style: solid; box-shadow: 0 4px 0; }
        #action-btn.ready { background-color: #4caf50; border-color: #388e3c; } #action-btn.decision { background-color: #f44336; border-color: #d32f2f; }
        #action-btn:active { transform: translateY(3px); box-shadow: 0 1px 0; }
        .splash { position: absolute; width: 100px; height: 100px; background-color: white; border-radius: 50%; opacity: 0.7; animation: splash-effect 0.5s ease-out forwards; z-index: 15; } @keyframes splash-effect { from { transform: scale(0); opacity: 0.7; } to { transform: scale(2); opacity: 0; } }
        
        .game-object { 
            position: absolute; background-size: contain; background-repeat: no-repeat; cursor: pointer; 
            animation: float 10s ease-in-out infinite; z-index: 20; /* 낚싯대보다 위에 오도록 z-index 조정 */
            transition: transform 0.2s; will-change: transform;
            display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start;
        } 
        .game-object:hover { transform: scale(1.15) rotate(5deg); } 
        @keyframes float { 0% { transform: translate(0, 0) rotate(-5deg); } 50% { transform: translate(15px, -15px) rotate(5deg); } 100% { transform: translate(0, 0) rotate(-5deg); } }
        .fish-name { font-size: 0.9em; font-weight: bold; color: #333; background-color: rgba(255, 255, 255, 0.7); padding: 2px 5px; border-radius: 3px; margin-bottom: 5px; white-space: nowrap; text-align: center; pointer-events: none; }
        .mackerel { width: 150px; height: 113px; background-image: url('3.png'); }
        .tuna { width: 180px; height: 160px; background-image: url('4.png'); }
        .whale { width: 250px; height: 188px; background-image: url('5.png'); }
        .treasure-chest { width: 150px; height: 125px; background-image: url('6.png'); }
        .trash { width: 80px; height: 80px; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%238B4513" d="M20,90 L20,40 Q20,30 30,30 L70,30 Q80,30 80,40 L80,60 L95,60 L95,90 L20,90 Z M30,20 L70,20 L70,30 L30,30 Z"/></svg>'); }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 100; } .modal-content { background: #fdfaf1; padding: 20px 30px; border-radius: 15px; width: 90%; max-width: 500px; border: 10px solid #8B4513; position: relative; } .close-btn { position: absolute; top: 5px; right: 15px; font-size: 2.5em; cursor: pointer; } #aquarium-list { list-style: none; padding: 0; max-height: 400px; overflow-y: auto; } #aquarium-list li { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #ddd; } #aquarium-list li button { font-family: 'Jua', sans-serif; font-size: 0.9em; padding: 3px 8px; background-color: #ef5350; border: none; color: white; border-radius: 5px; cursor:pointer;}
    </style>
</head>
<body>
    <audio id="cast-sound" src="path/to/casting.mp3"></audio>
    <audio id="splash-sound" src="path/to/splash.mp3"></audio>
    <audio id="click-sound" src="path/to/click.mp3"></audio>

    <div class="game-world">
        <div id="fish-container"></div>
        <div class="fishing-rod" id="fishing-rod"></div>
        <div class="control-panel">
            <div class="filter-group">
                <label class="group-title">낚시터</label>
                <div style="display: flex; gap: 5px;">
                    <select id="loc-major"><option value="all">- 전국 -</option></select>
                    <select id="loc-minor" disabled><option value="">- 시/군/구 -</option></select>
                </div>
            </div>
            <div class="filter-group">
                <label class="group-title">특제 미끼 (직무)</label>
                <div class="checkbox-section">
                    <div id="job-roles-dev" class="checkbox-container"></div>
                    <div id="job-roles-biz" class="checkbox-container"></div>
                </div>
            </div>
            <div class="filter-group">
                <label class="group-title">미끼 등급 (경력)</label>
                <div id="years-container" class="checkbox-container"></div>
            </div>
            <div class="game-controls">
                <div class="gauge-container"><div class="gauge-label">파워</div><div class="power-gauge" id="power-gauge"><div class="power-bar" id="power-bar"></div></div></div>
                <div class="gauge-container"><div class="gauge-label">방향</div><div class="angle-gauge" id="angle-gauge"><div class="angle-indicator" id="angle-indicator"></div></div></div>
                <button id="action-btn" class="ready">캐스팅 시작</button>
            </div>
        </div>
        <button id="aquarium-btn">내 수족관</button>
    </div>
    
    <script>
        // --- 데이터 ---
        const locations = {
            "서울": { "전체": "seoul", "강남구": "seoul.gangnam-gu", "서초구": "seoul.seocho-gu", "송파구": "seoul.songpa-gu", "마포구": "seoul.mapo-gu", "영등포구": "seoul.yeongdeungpo-gu", "구로구": "seoul.guro-gu", "금천구": "seoul.geumcheon-gu", "성동구": "seoul.seongdong-gu" },
            "경기": { "전체": "gyeonggi", "성남시": "gyeonggi.seongnam-si", "수원시": "gyeonggi.suwon-si", "용인시": "gyeonggi.yongin-si", "화성시": "gyeonggi.hwaseong-si", "고양시": "gyeonggi.goyang-si" },
            "부산": { "전체": "busan" }, "인천": { "전체": "incheon" }, "대구": { "전체": "daegu" }, "대전": { "전체": "daejeon" }, "광주": { "전체": "gwangju" }
        };
        const jobRoles = {
            "개발": { "서버/백엔드": 872, "프론트엔드": 873, "웹 풀스택": 518, "안드로이드": 899, "iOS": 895, "데브옵스": 655, "데이터 엔지니어": 677, "AI/ML": 678, "DBA": 517, "QA": 665 },
            "기획/마케팅": { "서비스 기획": 674, "PM": 672, "사업개발": 530, "콘텐츠 마케터": 900, "퍼포먼스 마케터": 659, "브랜드 마케터": 660, "디자이너": 507 }
        };
        const yearsData = { "경력무관": -1, "신입": 0, "1~3년": 1, "4~6년": 4, "7~9년": 7, "10년+": 10 };

        // --- DOM Elements ---
        const actionBtn = document.getElementById('action-btn');
        const powerGauge = document.getElementById('power-gauge');
        const powerBar = document.getElementById('power-bar');
        const angleGauge = document.getElementById('angle-gauge');
        const angleIndicator = document.getElementById('angle-indicator');
        const fishingRod = document.getElementById('fishing-rod');
        const fishContainer = document.getElementById('fish-container');
        const locMajorSelect = document.getElementById('loc-major');
        const locMinorSelect = document.getElementById('loc-minor');
        const yearsContainer = document.getElementById('years-container');
        const jobRolesDevContainer = document.getElementById('job-roles-dev');
        const jobRolesBizContainer = document.getElementById('job-roles-biz');
        
        let gameState = 'ready'; let power = 0; let angle = 0; let currentJobData = null;
        
        const sounds = { cast: document.getElementById('cast-sound'), splash: document.getElementById('splash-sound'), click: document.getElementById('click-sound'), };
        function playSound(name) { try { if (sounds[name]) { sounds[name].currentTime = 0; sounds[name].play(); } } catch (e) {} }

        const jobModal = { bg: document.getElementById('job-modal'), title: document.getElementById('modal-title'), fishType: document.getElementById('modal-fish-type'), company: document.getElementById('modal-company'), location: document.getElementById('modal-location'), link: document.getElementById('modal-link'), addBtn: document.getElementById('add-to-aquarium-btn') };
        const aquariumModal = { bg: document.getElementById('aquarium-modal'), list: document.getElementById('aquarium-list') };

        function init() {
            Object.keys(locations).forEach(major => locMajorSelect.add(new Option(major, major)));
            jobRolesDevContainer.innerHTML = '<div class="category-title">개발</div>';
            jobRolesBizContainer.innerHTML = '<div class="category-title">기획/마케팅</div>';
            Object.entries(jobRoles["개발"]).forEach(([name, id]) => jobRolesDevContainer.innerHTML += `<label><input type="checkbox" name="job_roles" value="${id}">${name}</label>`);
            Object.entries(jobRoles["기획/마케팅"]).forEach(([name, id]) => jobRolesBizContainer.innerHTML += `<label><input type="checkbox" name="job_roles" value="${id}">${name}</label>`);
            Object.entries(yearsData).forEach(([name, value]) => yearsContainer.innerHTML += `<label><input type="checkbox" name="years" value="${value}">${name}</label>`);
            
            actionBtn.addEventListener('click', handleAction);
            locMajorSelect.addEventListener('change', populateMinorLocations);
            document.getElementById('aquarium-btn').addEventListener('click', showAquarium);
            jobModal.bg.querySelector('.close-btn').addEventListener('click', () => jobModal.bg.style.display = 'none');
            aquariumModal.bg.querySelector('.close-btn').addEventListener('click', () => aquariumModal.bg.style.display = 'none');
            jobModal.addBtn.addEventListener('click', () => { if (currentJobData) addToAquarium(currentJobData); });
            aquariumModal.list.addEventListener('click', (e) => { if(e.target.tagName === 'BUTTON') removeFromAquarium(parseInt(e.target.dataset.id)); });
            
            const noExpCheckbox = yearsContainer.querySelector('input[value="-1"]');
            noExpCheckbox.addEventListener('change', () => {
                const isChecked = noExpCheckbox.checked;
                yearsContainer.querySelectorAll('input[name="years"]').forEach(cb => {
                    if (cb !== noExpCheckbox) { cb.disabled = isChecked; if (isChecked) cb.checked = false; cb.parentElement.classList.toggle('disabled-label', isChecked); }
                });
            });
            populateMinorLocations();
        }
        
        function populateMinorLocations() {
            const major = locMajorSelect.value;
            locMinorSelect.innerHTML = '';
            locMinorSelect.disabled = true;
            if (major && major !== 'all' && locations[major]) {
                const districts = locations[major];
                // '전체' 옵션 추가 (선택적)
                if (Object.keys(districts).length > 1) { // 1차 지역만 있는 경우 '전체'를 기본으로
                    locMinorSelect.add(new Option("- 전체 -", districts['전체']));
                }
                Object.entries(districts).forEach(([name, slug]) => {
                    if (name !== '전체') { // '전체'는 이미 위에서 추가했거나, 1차 지역만 있는 경우 자동 처리
                        locMinorSelect.add(new Option(name, slug));
                    }
                });
                locMinorSelect.disabled = false;
            }
        }

        function handleAction() { switch (gameState) { case 'ready': startPowerPhase(); break; case 'power': lockPowerPhase(); break; case 'angle': lockAngleAndCast(); break; } }
        function startPowerPhase() { gameState = 'power'; actionBtn.textContent = '결정!'; actionBtn.className = 'decision'; powerGauge.classList.add('active'); }
        function lockPowerPhase() { power = powerBar.offsetWidth / powerGauge.offsetWidth * 100; powerGauge.classList.remove('active'); gameState = 'angle'; angleGauge.classList.add('active'); }
        
        async function lockAngleAndCast() {
            const rect = angleGauge.getBoundingClientRect();
            const indicatorRect = angleIndicator.getBoundingClientRect();
            angle = ((indicatorRect.left + indicatorRect.width / 2) - rect.left) / rect.width * 2 - 1;
            angleGauge.classList.remove('active');
            gameState = 'fetching';
            actionBtn.disabled = true;
            actionBtn.textContent = '낚는 중...';
            fishingRod.classList.add('casting');
            playSound('cast');
            await new Promise(r => setTimeout(r, 500));
            fishingRod.classList.remove('casting');
            try {
                const jobs = await fetchJobs(power, angle);
                displayResults(jobs);
            } catch (error) {
                console.error("API 요청 실패:", error);
                alert("이런, 허탕이네요!\n\n원인: API 서버 또는 프록시 서버에 문제가 발생했습니다.\n\n해결책:\n1. 잠시 후 다시 시도해보세요.\n2. (개발자용) 브라우저의 CORS Unblock 확장 프로그램을 켜고, 코드의 PROXY_URL을 빈 문자열('')로 변경해보세요.");
            } finally {
                gameState = 'ready'; actionBtn.disabled = false; actionBtn.textContent = '캐스팅 시작'; actionBtn.className = 'ready';
            }
        }
        
        async function fetchJobs(power, angle) {
            const params = new URLSearchParams({ country: 'kr', job_sort: 'company.response_rate_order' });
            let limit = 15; if (power > 90) limit = 40; else if (power > 60) limit = 25; params.set('limit', limit);
            
            const majorLocKey = locMajorSelect.value;
            const minorLocSlug = locMinorSelect.value; // 이제 minorLocSelect.value 자체가 슬러그임
            if (majorLocKey !== 'all') {
                const finalLocSlug = minorLocSlug || locations[majorLocKey]['전체'];
                if (finalLocSlug) params.set('locations', finalLocSlug);
            }
            
            const selectedRoles = Array.from(document.querySelectorAll('input[name="job_roles"]:checked')).map(cb => cb.value);
            selectedRoles.forEach(roleId => params.append('tag_type_ids', roleId));
            
            const selectedYears = Array.from(document.querySelectorAll('input[name="years"]:checked')).map(cb => cb.value);
            if (selectedYears.includes('-1')) {
                params.set('years', '-1');
            } else if (selectedYears.length > 0) {
                selectedYears.forEach(year => params.append('years', year));
            }
            
            let baseKeyword = "";
            if (angle < -0.6) baseKeyword += " 스타트업";
            else if (angle > 0.6) baseKeyword += " 대기업";
            if (baseKeyword.trim()) params.set('keyword', baseKeyword.trim());
            
            const WANTED_URL = `https://www.wanted.co.kr/api/v4/jobs?${params.toString()}`;
            const PROXY_URL = 'https://api.allorigins.win/raw?url=';
            const requestUrl = PROXY_URL ? PROXY_URL + encodeURIComponent(WANTED_URL) : WANTED_URL;
            
            const response = await fetch(requestUrl);
            if (!response.ok) throw new Error(`HTTP Error! Status: ${response.status}`);
            return (await response.json()).data;
        }

        function displayResults(jobs) {
            fishContainer.innerHTML = '';
            if (!jobs || jobs.length === 0) {
                const trash = document.createElement('div');
                trash.className = 'game-object trash';
                trash.style.top = `${55 + Math.random() * 20}%`; trash.style.left = `${10 + Math.random() * 70}%`;
                fishContainer.appendChild(trash); return;
            }
            jobs.forEach((job, i) => {
                setTimeout(() => {
                    const top = 55 + Math.random() * 30; const left = 10 + Math.random() * 70;
                    const splash = document.createElement('div');
                    splash.className = 'splash';
                    splash.style.top = `${top}%`; splash.style.left = `${left}%`;
                    fishContainer.appendChild(splash); playSound('splash');
                    
                    const obj = document.createElement('div');
                    const objInfo = getObjectType(job);
                    obj.className = `game-object ${objInfo.className}`;
                    obj.style.top = `${top}%`; obj.style.left = `${left}%`;
                    obj.style.animationDelay = `${Math.random() * 5}s`;
                    
                    // --- [추가] 회사 이름 텍스트 노출 ---
                    const companyName = document.createElement('div');
                    companyName.className = 'fish-name';
                    companyName.textContent = job.company.name;
                    obj.appendChild(companyName); // 물고기 객체 내부에 회사 이름 추가

                    obj.addEventListener('click', () => showJobDetails(job, objInfo));
                    fishContainer.appendChild(obj);
                }, i * 150);
            });
        }

        function getObjectType(job) {
            if (job.like_count > 200 && job.company.response_level === 'very_high') { return { className: 'treasure-chest', name: '보물 상자 ★★★★★' }; }
            const name = job.company.name.toLowerCase();
            const pos = job.position.toLowerCase();
            if (['네이버', '카카오', '라인', '쿠팡', '배달의민족', '토스'].some(c => name.includes(c))) { return { className: 'whale', name: '우주 고래 (최상위 기업)' }; }
            if (pos.includes('cto') || pos.includes('리드') || job.like_count > 100) { return { className: 'tuna', name: '참치 (리드급/인기)' }; }
            return { className: 'mackerel', name: '고등어 (일반)' };
        }
        
        function showJobDetails(job, objInfo) {
            currentJobData = job;
            jobModal.title.textContent = job.position;
            jobModal.fishType.textContent = objInfo.name;
            jobModal.company.textContent = job.company.name;
            jobModal.location.textContent = job.address.full_location || '정보 없음';
            jobModal.link.href = `https://www.wanted.co.kr/wd/${job.id}`;
            jobModal.bg.style.display = 'flex';
            playSound('click');
        }

        function addToAquarium(job) { let aquarium = JSON.parse(localStorage.getItem('myAquarium')) || []; if (!aquarium.some(item => item.id === job.id)) { aquarium.push({ id: job.id, position: job.position, company: job.company.name }); localStorage.setItem('myAquarium', JSON.stringify(aquarium)); alert('수족관에 추가했습니다!'); } else { alert('이미 수족관에 있습니다.'); } }
        function showAquarium() { const aquarium = JSON.parse(localStorage.getItem('myAquarium')) || []; aquariumModal.list.innerHTML = aquarium.length ? '' : '<li>수족관이 비었습니다.</li>'; aquarium.forEach(fish => { aquariumModal.list.innerHTML += `<li><div><strong>${fish.position}</strong><br><span>${fish.company}</span></div><button data-id="${fish.id}">방생</button></li>`; }); aquariumModal.bg.style.display = 'flex'; playSound('click'); }
        function removeFromAquarium(fishId) { let aquarium = JSON.parse(localStorage.getItem('myAquarium')) || []; localStorage.setItem('myAquarium', JSON.stringify(aquarium.filter(f => f.id !== fishId))); showAquarium(); }

        init();
    </script>
</body>
</html>
